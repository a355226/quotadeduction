<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<!-- åˆ†é ç”¨ -->
<link rel="icon" type="image/png" sizes="32x32" href="icon.png">

<!-- iOS ä¸»ç•«é¢ç”¨ -->
<link rel="apple-touch-icon" sizes="180x180" href="icon.png">

<!-- Android PWA -->
<link rel="manifest" href="manifest.json">
  <meta charset="UTF-8">
  <title>é¦–æœˆé¡åº¦è¨ˆç®—å™¨</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <style>
    body { font-family: 'Segoe UI', sans-serif; padding: 2em; background: #f4f8fb; }
    h2 { text-align: center; color: #333; }
    .date-controls, .options, .result { margin: 1em 0; text-align: center; }
    button { padding: 0.5em 1em; margin: 0 0.5em; border: none; background: #007bff; color: white; border-radius: 4px; cursor: pointer; }
    button:hover { background: #0056b3; }
    input[type="checkbox"] { transform: scale(1.5); margin-left: 10px; vertical-align: middle; }
    .output-box {
  background: white;
  padding: 1em;
  border-radius: 6px;
  margin: 1em auto;
  max-width: 325px;  /* âœ… é™åˆ¶æœ€å¤§å¯¬åº¦ */
  box-shadow: 0 0 5px #ccc;
}

    .copied { color: green; margin-top: 0.5em; font-weight: bold; }
.result-table .row {
  display: flex;
  justify-content: space-between;
  margin: 0.5em 0;
  font-size: 1.1em;
}
.result-table span {
  flex: none;
  text-align: left;
}
.result-table b {
  flex: none;
  text-align: right;
  min-width: 80px;
}

.options {
  display: flex;
  justify-content: center;
  flex-wrap: wrap;
  gap: 1.5em;  /* â† é€™è¡Œæ§åˆ¶é–“è· */
  margin: 1em 0;
  text-align: center;
}

.warning {
  color: #FF5151;
  font-weight: bold;
}

.footer-note {
  position: fixed;
  bottom: 10px;
  right: 15px;
  font-size: 0.9em;
  color: #aaa;
  font-style: italic;
  pointer-events: none;
  user-select: none;
}

  button {
    padding: 0.5em 1em;
    margin: 0 0.5em;
    border: none;
    background: #007bff;
    color: white;
    border-radius: 4px;
    cursor: pointer;
    touch-action: manipulation;  /* âœ… æ–°å¢é€™ä¸€è¡Œ */
  }

select {
  font-size: 1.2em;
  padding: 0.1em 0.9em;
  min-width: 100px; /* æ”¾å¤§ CMS é¸å–®å¯¬åº¦ */
  border-radius: 6px;
  border: 1px solid #ccc;
text-align: center;
}

input[type="date"] {
  font-size: 1.2em;
  padding: 0.4em 0.6em;
  width: 180px;
  border-radius: 6px;
  border: 1px solid #ccc;
  text-align: center;  /* âœ… æ—¥æœŸæ–‡å­—ç½®ä¸­ */
-webkit-appearance: none; /* âœ… è§£æ±º Android Chrome ä¸ç½®ä¸­å•é¡Œ */
  appearance: none;
}

.date-controls {
  display: flex;
  justify-content: center;
  align-items: center;
  gap: 0.5em; /* æŒ‰éˆ•èˆ‡æ¬„ä½é–“è· */
  flex-wrap: nowrap;    /* âœ… ç¦æ­¢æ›è¡Œ */
}

.date-controls input[type="date"] {
  flex-shrink: 0;
  width: 180px;         /* å›ºå®šå¯¬åº¦ï¼Œé˜²æ­¢è‡ªå‹•æ”¶çª„ */
  font-size: 1.2em;
  text-align: center;
  padding: 0.4em 0.6em;
  border-radius: 6px;
  border: 1px solid #ccc;
}

select {
  text-align: center;
  text-align-last: center; /* âœ… å°IOS select æœ‰æ•ˆçš„ç½®ä¸­æ–¹å¼ */
}

input[type="date"]::-webkit-datetime-edit {
  text-align: center;
}

input[type="date"]::-webkit-inner-spin-button,  /* âœ… å°android select æœ‰æ•ˆçš„ç½®ä¸­æ–¹å¼ */
input[type="date"]::-webkit-calendar-picker-indicator {
  margin-left: auto;
  margin-right: auto;
}

/* âœ… å¼·åŒ– Android æ—¥æœŸæ¬„ä½æ–‡å­—ç½®ä¸­ */
input[type="date"]::-webkit-datetime-edit {
  text-align: center;
  display: inline-block;
  width: 100%;
}

/* âœ… è§£æ±ºæ—¥æœŸæ¬„ä½å·¦å³å…§è·/åœ–ç¤ºæ­ªæ–œå•é¡Œ */
input[type="date"]::-webkit-inner-spin-button,
input[type="date"]::-webkit-calendar-picker-indicator {
  margin: 0 auto;
  display: block;
  position: relative;
}
    
.shrink-trigger {  /* âœ… é¿é–‹ "btn"ã€"shrink" é—œéµå­— */
  display: none;
  position: fixed;     /* âœ… æ”¹ç‚º fixed ä¹Ÿæ¯”è¼ƒç©©å®š */
  top: 12px;
  right: 12px;
  padding: 0.4em 0.9em;
  font-size: 0.9em;
  background-color: #007bff;
  color: white;
  border: none;
  border-radius: 6px;
  cursor: pointer;
  z-index: 9999;
}
@media screen and (min-width: 900px) {
  .shrink-trigger {
    display: block;
  }
}



  </style>
</head>
<body>

<h2>
  <img src="https://cdn.jsdelivr.net/gh/a355226/quotadeduction/icon.png" alt="icon" style="height: 1.8em; vertical-align: middle; margin-right: 0.3em;">
  é¦–æœˆé¡åº¦è¨ˆç®—å™¨
</h2>

<div class="date-controls">
  <button onclick="changeDate(-1)">ï¼</button>
  <input type="date" id="selectDate" value="2025-06-14" onchange="updateResults()" onkeydown="return false;" />
  <button onclick="changeDate(1)">ï¼‹</button>
</div>

<div class="options">
  <label>CMS ç­‰ç´šï¼š
    <select id="cmsSelect" onchange="updateResults()">
      <option value="">è«‹é¸æ“‡</option>
      <option value="2">2ç´š</option>
      <option value="3">3ç´š</option>
      <option value="4">4ç´š</option>
      <option value="5">5ç´š</option>
      <option value="6">6ç´š</option>
      <option value="7">7ç´š</option>
      <option value="8">8ç´š</option>
    </select>
  </label>
  <label>
    æœ‰å¤–ç±çœ‹è­·
    <input type="checkbox" id="hasForeign" onchange="updateResults()">
  </label>
</div>

<div class="result">
  <div class="output-box" id="resultBox">è«‹å…ˆé¸æ“‡ CMS ç­‰ç´šèˆ‡æ—¥æœŸ</div>
</div>

<div class="options">
  <button onclick="copyText()">ä¸€éµè¤‡è£½ç½é ­</button>
  <div id="copyConfirm" class="copied" style="display:none;">è¤‡è£½æˆåŠŸï¼</div>
</div>

<script>
const cmsData = {
  2: { no_foreign: 10020, with_foreign: 3006 },
  3: { no_foreign: 15460, with_foreign: 4638 },
  4: { no_foreign: 18580, with_foreign: 5574 },
  5: { no_foreign: 24100, with_foreign: 7230 },
  6: { no_foreign: 28070, with_foreign: 8421 },
  7: { no_foreign: 32090, with_foreign: 9627 },
  8: { no_foreign: 36180, with_foreign: 10854 }
};

function getMonthDays(date) {
  const d = new Date(date);
  return new Date(d.getFullYear(), d.getMonth() + 1, 0).getDate();
}

function getDayOfMonth(date) {
  return new Date(date).getDate();
}

function changeDate(offset) {
  const dateInput = document.getElementById("selectDate");
  const d = new Date(dateInput.value);
  d.setDate(d.getDate() + offset);
  dateInput.valueAsDate = d;
  updateResults();
}

function copyText() {
  const text = `ä¾æ“šé•·æœŸç…§é¡§æœå‹™ç”³è«‹åŠçµ¦ä»˜è¾¦æ³•ç¬¬ä¸‰ç« ç¬¬12æ¢ï¼Œæœªæ»¿1å€‹æœˆè€…æŒ‰æ¯”ä¾‹è¨ˆç®—ç…§é¡§åŠäº¤é€šæ¥é€é¡åº¦ã€‚`;
  navigator.clipboard.writeText(text).then(() => {
    document.getElementById("copyConfirm").style.display = "block";
    setTimeout(() => {
      document.getElementById("copyConfirm").style.display = "none";
    }, 1500);
  });
}

function updateResults() {
  const dateStr = document.getElementById("selectDate").value;
  const cmsLevel = document.getElementById("cmsSelect").value;
  const hasForeign = document.getElementById("hasForeign").checked;
  const resultBox = document.getElementById("resultBox");

if (!dateStr || !cmsLevel) {
  resultBox.innerHTML = `<span class="warning">è«‹å…ˆé¸æ“‡æ—¥æœŸèˆ‡CMSç­‰ç´š</span>`;
  return;
}


  const monthDays = getMonthDays(dateStr);
  const passedDays = getDayOfMonth(dateStr) - 1;
  const ratio = passedDays / monthDays;

  const base = cmsData[cmsLevel][hasForeign ? "with_foreign" : "no_foreign"];
  const careReduced = Math.round(base * ratio);
  const transportBase = 1680;
  const transportReduced = Math.round(transportBase * ratio);

  resultBox.innerHTML = `
    <b>CMS ${cmsLevel} ç´š${hasForeign ? "ï¼ˆæœ‰å¤–çœ‹ï¼‰" : ""}</b>
    <div class="result-table">
      <div class="row"><span>ğŸ§“ æ‰£é™¤ç…§é¡§å°ˆæ¥­é¡åº¦ï¼š</span><b>${careReduced.toLocaleString('en-US')} å…ƒ</b></div>
      <div class="row"><span>ğŸš æ‰£é™¤äº¤é€šæ¥é€é¡åº¦ï¼š</span><b>${transportReduced.toLocaleString('en-US')} å…ƒ</b></div>
  `;
}
window.onload = () => {
  updateResults();
};

const dateInput = document.getElementById('selectDate');

// 1. é»æ¬„æ¡†ï¼šä¿éšªèµ·è¦‹æ‰‹å‹•å«å‡ºæ—¥æ›†
dateInput.addEventListener('click', () => {
  if (dateInput.showPicker) {          // Chromium å®¶æ—
    dateInput.showPicker();
  } else {                             // å…¶ä»–ç€è¦½å™¨
    dateInput.focus();                 // è‡³å°‘æŠŠæ¸¸æ¨™å¸¶é€²å»
  }
});
  if ('serviceWorker' in navigator) {
    window.addEventListener('load', () => {
      navigator.serviceWorker.register('/service-worker.js')
        .then(reg => console.log('ServiceWorker è¨»å†ŠæˆåŠŸ:', reg.scope))
        .catch(err => console.log('ServiceWorker è¨»å†Šå¤±æ•—:', err));
    });
  }
const version = '20240616';

document.querySelectorAll('link[rel="icon"], link[rel="manifest"]').forEach(el => {
  const attr = 'href';
  el[attr] += (el[attr].includes('?') ? '&' : '?') + 'v=' + version;
});


function openMiniWindow() {
  const miniWindow = window.open(
    window.location.href,
    'miniQuotaCalc',
    'width=400,height=600,scrollbars=no,resizable=no'
  );
  if (miniWindow) {
    miniWindow.focus();
  } else {
    alert("ç„¡æ³•é–‹å•Ÿè¿·ä½ è¦–çª—ï¼Œè«‹æª¢æŸ¥æ˜¯å¦æœ‰ç€è¦½å™¨é˜»æ“‹å½ˆå‡ºè¦–çª—ã€‚");
  }
}

 window.addEventListener('DOMContentLoaded', () => {
  const btn = document.querySelector('.shrink-trigger');
  if (btn && window.innerWidth >= 900) {
    btn.style.display = 'block';
  }
});

// ğŸŸ¡ é™¤éŒ¯æ¨¡å¼é–‹é—œï¼ˆå¯é—œé–‰ï¼‰
const DEBUG = true;

function openMiniWindow() {
  const miniWindow = window.open(
    window.location.href,
    'miniQuotaCalc',
    'width=400,height=600,scrollbars=no,resizable=no'
  );
  if (miniWindow) {
    miniWindow.focus();
  } else {
    alert("ç„¡æ³•é–‹å•Ÿè¿·ä½ è¦–çª—ï¼Œè«‹æª¢æŸ¥æ˜¯å¦æœ‰ç€è¦½å™¨é˜»æ“‹å½ˆå‡ºè¦–çª—ã€‚");
  }
}

function createShrinkButton() {
  const alreadyHasBtn = document.querySelector('.shrink-trigger');
  if (alreadyHasBtn) {
    if (DEBUG) console.warn("âš ï¸ ç™¼ç¾å·²æœ‰ shrink-triggerï¼Œè·³éå»ºç«‹");
    return;
  }

  if (window.innerWidth >= 900) {
    const btn = document.createElement("button");
    btn.textContent = "ğŸ“Ÿ å°è¦–çª—æ¨¡å¼";
    btn.className = "shrink-trigger";
    btn.onclick = openMiniWindow;

    document.body.appendChild(btn);

    if (DEBUG) {
      console.log("âœ… å°è¦–çª—æŒ‰éˆ•å·²æ’å…¥ DOM");
      showDebugMessage("âœ… å°è¦–çª—æŒ‰éˆ•å·²æ’å…¥");
    }
  } else {
    if (DEBUG) {
      console.warn("â›” ç•«é¢å¯¬åº¦å°æ–¼ 900pxï¼Œæœªæ’å…¥æŒ‰éˆ•");
      showDebugMessage("â›” è¢å¹•å¯¬åº¦å¤ªçª„ï¼ˆ" + window.innerWidth + "pxï¼‰æœªæ’å…¥æŒ‰éˆ•");
    }
  }
}

function showDebugMessage(msg) {
  let div = document.getElementById("debug-log");
  if (!div) {
    div = document.createElement("div");
    div.id = "debug-log";
    div.style.position = "fixed";
    div.style.bottom = "40px";
    div.style.right = "15px";
    div.style.background = "rgba(0,0,0,0.7)";
    div.style.color = "#fff";
    div.style.padding = "0.5em 1em";
    div.style.fontSize = "0.9em";
    div.style.borderRadius = "6px";
    div.style.zIndex = "99999";
    document.body.appendChild(div);
  }
  div.textContent = msg;
  clearTimeout(div._timeout);
  div._timeout = setTimeout(() => div.remove(), 5000);
}

window.addEventListener("load", createShrinkButton);


 
</script>
<div class="footer-note">Designed by KJ&nbsp;&nbsp;</div>
</body>
</html>


